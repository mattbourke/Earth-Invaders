function invaderObject(a,b,c){var d=gameModule.getInvadersCreated();return global.invader[d]=deepCopy(invader),global.invader[d].shape=c.invaderShape,global.invader[d].fallingSpeed=c.invaderSpeed,global.invader[d].pos=[a,b],global.invader[d].invaderID="invader_"+d,global.invader[d].timerFunction(),global.invader[d].dropBomb(),global.invader[d]}function laserObject(a,b,c){var d=gameModule.getRoundsFired(),e=deepCopy(laser);return e.position=[a,b],e.roundID="laser_"+d,e.direction=c,e.timerFunction(),e}function deepCopy(a,b){var b=b||{};for(var c in a)"object"==typeof a[c]?(b[c]=a[c].constructor===Array?[]:{},deepCopy(a[c],b[c])):b[c]=a[c];return b}var boardModule=function(){function a(a){for(var b=0,c=a.length;c>b;b++)invaderObject(parseInt(a[b],10),50,gameJson.Levels[gameModule.getCurrentLevel()])}function b(){var a=document.querySelectorAll(".invader").length?!0:!1;if(!a){var b=gameModule.getNextLevel();b<gameModule.getTotalLevels()?(d(b),gameModule.displayLevel()):gameModule.stop("winner")}return a}var c=function(a){gameJson=a,gameModule.setTotalLevels(gameJson.Levels.length-1)},d=function(b){gameJson.Levels[b];a(gameJson.Levels[gameModule.getCurrentLevel()].invaderPositions.split(","))};return{init:c,invadersExists:b,startLevel:d}}(),gameModule=function(){function a(){u=u===!0?!1:!0}function b(){return u}function c(a){v=!0;var b="winner"===a?"Champion!":"Game Over - Loser!";document.getElementById("status").innerHTML=b,document.getElementById("overlay").style.display="block",document.getElementById("start").disabled=!1,"winner"===a&&d(),D()}function d(){!function a(b){setTimeout(function(){b>=0&&(document.getElementById("status").innerHTML=r[b],b--,a(b))},1500)}(r.length-1)}function e(){return v}function f(){document.getElementById("stop").disabled=!1,document.getElementById("status").innerHTML="Enemy inbound",v=!1;var a=5,b=function(){return a-=1,0>a?(clearInterval(c),document.getElementById("overlay").style.display="none",void boardModule.startLevel(0)):void(document.getElementById("status").innerHTML=a)},c=setInterval(b,1e3);l(),o()}function g(){x++,j(1)}function h(){return x}function i(){return s}function j(a){s+=a,l()}function k(a){s-=a,l()}function l(){document.getElementById("result").innerHTML=s}function m(){return w="undefined"==typeof w?1:w+1}function n(){return y="undefined"==typeof y?1:y+1}function o(){var a=q()+1,b=C()+1;document.getElementById("levelStatus").innerHTML=b+" of "+a}function p(a){A=a}function q(){return A}var r=["By Matt Bourke","2014","Earth Invaders","Version 0.1"],s=0,t=0,u=!1,v=!0,w=0,x=0,y=0,z=0,A=0,B=function(){return z++},C=function(){return z},D=function(){s=0,t=0,u=!1,v=!0,w=0,x=0,y=0,z=0,A=0};return{pause:a,isPaused:b,start:f,stop:c,isStopped:e,setInvaderHit:g,getInvadersHit:h,getNextLevel:B,displayLevel:o,getInvadersCreated:m,getRoundsFired:n,config:r,increaseScore:j,decreaseScore:k,setTotalLevels:p,getTotalLevels:q,getCurrentLevel:C,getScore:i}}(),defenceGun={shape:"1111111|0001000",now:[1,0],position:[1,0],getDiv:function(a,b){return document.querySelector('[data-y="'+b+'"] [data-x="'+a+'"]')},draw:function(a,b){for(var c=this.shape.split("|").map(function(a){return a.split("")}),d=c.length,e=0;d>e;e++)for(var f=c[e].length,g=0;f>g;g++)if("1"===c[e][g]){if(g+this.position[0]+a[0]>=75)return!1;if(g+this.position[0]+a[0]<=0)return!1;if(this.getDiv(g+this.position[0]+a[0],e+this.position[1]+a[1]).classList.contains("on"))return!1;this.getDiv(g+this.position[0]+a[0],e+this.position[1]+a[1]).classList.add(void 0!==b?b:"defenceGun")}this.position=[this.position[0]+a[0],this.position[1]+a[1]]},deDraw:function(){document.querySelectorAll(".defenceGun").length>0&&this.deDraw(document.querySelector(".defenceGun").classList.remove("defenceGun"))}},invader={invaderID:0,shape:"",now:[1,0],fallingSpeed:0,pos:[0,0],getDiv:function(a,b){return document.querySelector('[data-y="'+b+'"] [data-x="'+a+'"]')},draw:function(a,b){for(var c=this.shape.split("|").map(function(a){return a.split("")}),d=0,e=c.length;e>d;d++)for(var f=0,g=c[d].length;g>f;f++)if("1"===c[d][f]){if(d+this.pos[1]+a[1]===0||gameModule.isStopped())return this.deleteObject(),gameModule.stop(),!1;try{if(this.getDiv(f+this.pos[0]+a[0],d+this.pos[1]+a[1]).classList.contains("defenceGun"))return this.deleteObject(),gameModule.stop(),!1}catch(h){return this.deleteObject(),gameModule.stop(),!1}this.getDiv(f+this.pos[0]+a[0],d+this.pos[1]+a[1]).classList.add(void 0!==b?b:"invader"),this.getDiv(f+this.pos[0]+a[0],d+this.pos[1]+a[1]).classList.add(this.invaderID)}this.pos=[this.pos[0]-a[0],this.pos[1]-a[1]]},deDraw:function(){var a=".brick.invader."+this.invaderID;document.querySelectorAll(a).length>0&&this.deDraw(document.querySelector(a).classList.removeMany("invader "+this.invaderID))},deleteObject:function(){this.fallingSpeed=-1,this.deDraw(),clearInterval(this.bombingInterval),clearInterval(this.invaderID)},move:function(){!1===this.draw([0,1],void 0,this.deDraw())},dropBomb:function(){var a=this,b=this.pos[0]+5,c=this.pos[1]-3;new laserObject(b,c,"down"),this.bombingInterval&&clearInterval(this.bombingInterval),this.bombingInterval=setInterval(function(){a.dropBomb()},3e3)},timerFunction:function(){var a=this;gameModule.isPaused()===!1&&this.move(),invader[a.invaderID]=setTimeout(function(){gameModule.isStopped()&&a.deleteObject(),a.fallingSpeed>=0?a.timerFunction():(clearInterval(a.invaderID),a=null)},a.fallingSpeed=a.fallingSpeed)}},laser={roundID:0,shape:"1",now:[1,0],fallingSpeed:30,direction:"",inPlay:!0,position:[0,0],getDiv:function(a,b){return document.querySelector('[data-y="'+b+'"] [data-x="'+a+'"]')},draw:function(a,b){for(var c=this.shape.split("|").map(function(a){return a.split("")}),d=0;1>d;d++)for(var e=0;e<c[d].length;e++)if("1"===c[d][e]&&this.inPlay){if(d+this.position[1]+a[1]>60)return gameModule.decreaseScore(2),this.deleteObject(),!1;if(d+this.position[1]+a[1]<0||gameModule.isStopped())return this.deleteObject(),!1;if(this.getDiv(e+this.position[0]+a[0],d+this.position[1]+a[1]).classList.contains("defenceGun"))return this.inPlay=!1,gameModule.stop(),this.deleteObject(),!1;if(this.getDiv(e+this.position[0]+a[0],d+this.position[1]+a[1]).classList.contains("invader")){gameModule.setInvaderHit();var f=this.getDiv(e+this.position[0]+a[0],d+this.position[1]+a[1]).classList[2],g=parseInt(f.match(/\d+$/)[0],10),h=global.invader[g];return h.deleteObject(),delete global.invader[g],this.deleteObject(),boardModule.invadersExists(),!1}this.getDiv(e+this.position[0]+a[0],d+this.position[1]+a[1]).classList.add(void 0!==b?b:"laser"),this.getDiv(e+this.position[0]+a[0],d+this.position[1]+a[1]).classList.add(this.roundID)}this.position="up"===this.direction?[this.position[0]+a[0],this.position[1]+a[1]]:[this.position[0]-a[0],this.position[1]-a[1]]},deDraw:function(){var a=".brick.laser."+this.roundID;document.querySelectorAll(a).length>0&&this.deDraw(document.querySelector(a).classList.removeMany("laser "+this.roundID))},deleteObject:function(){this.fallingSpeed=-1,this.deDraw(),clearInterval(this.roundID)},move:function(){!1===this.draw([0,1],void 0,this.deDraw())},timerFunction:function(){var a=this;gameModule.isPaused()===!1&&this.move(),laser[a.roundID]=setTimeout(function(){a.fallingSpeed>=0?a.timerFunction():gameModule.isPaused()===!1&&clearInterval(a.roundID)},a.fallingSpeed=a.fallingSpeed)}};!function(){defenceGun.draw([0,0]);var a=[];window.addEventListener("keydown",keyDownFunction=function(b){function c(){var a=defenceGun.position[0]+3,b=defenceGun.position[1]+2;new laserObject(a,b,"up")}return gameModule.isPaused()===!0||gameModule.isStopped()===!0?!1:(a[b.keyCode]="keydown"===b.type,39!==b.keyCode&&37!==b.keyCode||!1!==defenceGun.draw([39===b.keyCode?1:-1,0],void 0,defenceGun.deDraw())||defenceGun.draw([0,0],void 0,defenceGun.deDraw()),a[32]&&a[39]?(c(),!1):a[32]&&a[37]?(c(),!1):32===b.keyCode?(c(),!1):void 0)}),window.addEventListener("keyup",keyDownFunction=function(){a=[]}),document.getElementById("start").onclick=function(a){a.stopPropagation(),boardModule.init(levelsJSON),this.disabled=!0,gameModule.start()},document.getElementById("pause").onclick=function(a){a.stopPropagation(),gameModule.pause()},document.getElementById("stop").onclick=function(a){a.stopPropagation(),this.disabled=!0,document.getElementById("start").disabled=!1,gameModule.stop()}}();var levelsJSON={Description:"level configurator - contains data for each level, some values are not yet used by the game",Levels:[{invaderSpeed:500,invaderShape:"|00011011000|10100000101|10111111101|11111111111|01101110110|00111111100|00100000100|01000000010",invaderPoints:1,bombShape:"1",bombSpeed:"",bombInterval:"",introMessage:"",invaderPositions:"15,30,45"},{invaderSpeed:300,invaderShape:"|00100000100|00010001000|00111111100|11111111111|10101110101|10111111101|00010001000|00100000100",invaderPoints:2,bombShape:"1",bombSpeed:"",bombInterval:"",introMessage:"Round 2, fight!",invaderPositions:"1,15,30,45,60"},{invaderSpeed:250,invaderShape:"|010000010|011111110|111101111|110111011|011111110|010000010|010000010",invaderPoints:2,bombShape:"1",bombSpeed:"",bombInterval:"",introMessage:"Round 3, fight!",invaderPositions:"1,30,60"},{invaderSpeed:200,invaderShape:"|000111000|011111110|011000110|010000010",invaderPoints:3,bombShape:"1",bombSpeed:"",bombInterval:"",introMessage:"Round 4, fight!",invaderPositions:"1,15,30,45,60"}]};DOMTokenList.prototype.addMany=function(a){for(var b=a.split(" "),c=0,d=b.length;d>c;c++)this.add(b[c])},DOMTokenList.prototype.removeMany=function(a){for(var b=a.split(" "),c=0,d=b.length;d>c;c++)this.remove(b[c])};var global=function(){return this||(1,eval)("this")}();